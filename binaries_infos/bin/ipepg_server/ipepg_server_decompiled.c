//
// This file was generated by the Retargetable Decompiler
// Website: https://retdec.com
// Copyright (c) 2018 Retargetable Decompiler <info@retdec.com>
//

#include <errno.h>
#include <fcntl.h>
#include <pthread.h>
#include <stdbool.h>
#include <stdint.h>
#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/socket.h>

// ------------------------ Structures ------------------------

struct _IO_FILE {
    int32_t e0;
};

// ------------------------- Classes --------------------------

// TiXmlComment (base classes: TiXmlNode)
// TiXmlElement (base classes: TiXmlNode)
// TiXmlPrinter (base classes: TiXmlVisitor)
// TiXmlUnknown (base classes: TiXmlNode)
// TiXmlVisitor
// TiXmlDocument (base classes: TiXmlNode)
// TiXmlAttribute (base classes: TiXmlBase)
// TiXmlDeclaration (base classes: TiXmlNode)
// TiXmlBase
// TiXmlNode (base classes: TiXmlBase)
// TiXmlText (base classes: TiXmlNode)

// ------------------- Function Prototypes --------------------

int32_t _Z10socketInitii(int32_t a1, int32_t a2);
int32_t _Z14init_tv_objectv(void);
int32_t _Z15uinit_tv_objectv(void);
int32_t _Z19ipepg_socketControli(int32_t sock);
int32_t _Z20init_protocol_objectv(void);
int32_t _Z21uinit_protocol_objectv(void);
int32_t _ZN6tvfunc14tv_open_key_fdEv(int32_t a1);
int32_t _ZN6tvfunc15tv_cli_ipc_initEv(int32_t a1);
int32_t _ZN6tvfuncC1Ev(int32_t result);
int32_t _ZN8protocolC1Ev(int32_t result);

// ------------------------ Functions -------------------------

// Address range: 0x9e60 - 0x9f1b
int main(int argc, char ** argv) {
    char * v1; // 0x23434
    char * v2; // 0x23438
    int32_t v3 = 0; // 0x2343c
    // 0x9e60
    struct _IO_FILE * stream; // 0x233e8
    if (_Z14init_tv_objectv() % 256 != 1) {
        // 0x9e76
        fprintf(stream, "--->ren<---init_tv_object error,function main,line num = %d\n", 9);
        exit(-1);
        // UNREACHABLE
    }
    // 0x9e98
    if (_Z20init_protocol_objectv() % 256 != 1) {
        // 0x9ea8
        fprintf(stream, "--->ren<---init_tv_object error,function main,line num = %d\n", 14);
        exit(-1);
        // UNREACHABLE
    }
    // 0x9eca
    _Z10socketInitii(0x101c, 10);
    fprintf(stream, "--->ren<---socketInit error,function main,line num = %d\n", 20);
    exit(-1);
    // UNREACHABLE
}

// Address range: 0x9f78 - 0x9f8f
// Demangled:     protocol::protocol()
int32_t _ZN8protocolC1Ev(int32_t result) {
    struct _IO_FILE * v1; // 0x233e8
    char * v2; // 0x23434
    char * v3; // 0x23438
    int32_t v4; // 0x2343c
    // 0x9f78
    return result;
}

// Address range: 0xbeb8 - 0xbf1b
// Demangled:     init_tv_object()
int32_t _Z14init_tv_objectv(void) {
    char * v1; // 0x23438
    int32_t v2; // 0x2343c
    int32_t v3 = (int32_t)_Znwj(1); // 0xbebe_3
    _ZN6tvfuncC1Ev(v3);
    char * v4; // 0x23434
    *(int32_t *)&v4 = v3;
    int32_t result = 1;
    if (v3 == 0) {
        // 0xbee4
        struct _IO_FILE * stream; // 0x233e8
        fprintf(stream, "--->ren<---init_tv_object error, in the function [%s] at linenumber [%d]\n", "init_tv_object", 16);
        result = 0;
        // branch -> 0xbf0c
    }
    // 0xbf0c
    return result;
}

// Address range: 0xbf1c - 0xbf4b
// Demangled:     uinit_tv_object()
int32_t _Z15uinit_tv_objectv(void) {
    struct _IO_FILE * v1; // 0x233e8
    char * v2; // 0x23438
    int32_t v3; // 0x2343c
    // 0xbf1c
    char * v4; // 0x23434
    char * v5 = v4;
    if (v5 != NULL) {
        // 0xbf2e
        _ZdlPv(v5);
        *(int32_t *)&v4 = 0;
        // branch -> 0xbf4a
    }
    // 0xbf4a
    return (int32_t)v5;
}

// Address range: 0xbf4c - 0xbfaf
// Demangled:     init_protocol_object()
int32_t _Z20init_protocol_objectv(void) {
    char * v1; // 0x23434
    int32_t v2; // 0x2343c
    int32_t v3 = (int32_t)_Znwj(1); // 0xbf52_3
    _ZN8protocolC1Ev(v3);
    char * v4; // 0x23438
    *(int32_t *)&v4 = v3;
    int32_t result = 1;
    if (v3 == 0) {
        // 0xbf78
        struct _IO_FILE * stream; // 0x233e8
        fprintf(stream, "--->ren<---init_protocol_object error, in the function [%s] at linenumber [%d]\n", "init_protocol_object", 36);
        result = 0;
        // branch -> 0xbfa0
    }
    // 0xbfa0
    return result;
}

// Address range: 0xbfb0 - 0xbfdf
// Demangled:     uinit_protocol_object()
int32_t _Z21uinit_protocol_objectv(void) {
    struct _IO_FILE * v1; // 0x233e8
    char * v2; // 0x23434
    int32_t v3; // 0x2343c
    // 0xbfb0
    char * v4; // 0x23438
    char * v5 = v4;
    if (v5 != NULL) {
        // 0xbfc2
        _ZdlPv(v5);
        *(int32_t *)&v4 = 0;
        // branch -> 0xbfde
    }
    // 0xbfde
    return (int32_t)v5;
}

// Address range: 0xc00c - 0xc153
// Demangled:     socketInit(int, int)
int32_t _Z10socketInitii(int32_t a1, int32_t a2) {
    char * v1; // 0x23434
    char * v2; // 0x23438
    int32_t v3; // 0x2343c
    // 0xc00c
    socket(AF_INET, SOCK_STREAM, IPPROTO_IP);
    int32_t err_num = *__errno_location(); // 0xc044
    char * err_str = strerror(err_num); // 0xc048
    int32_t v4 = *__errno_location(); // 0xc054
    struct _IO_FILE * stream; // 0x233e8
    fprintf(stream, "--->ren<---create socket error: %s(errno: %d)\n", err_str, v4);
    return -1;
}

// Address range: 0xc154 - 0xc2b3
// Demangled:     ipepg_socketControl(int)
int32_t _Z19ipepg_socketControli(int32_t sock) {
    char * v1; // 0x23438
    struct _IO_FILE * stream; // 0x233e8
    fprintf(stream, "--->ren<---start to accept,in Function [%s] , line Number [%d] \n", "ipepg_socketControl", 88);
    int32_t attr;
    pthread_attr_init(&attr);
    pthread_attr_setdetachstate(&attr, PTHREAD_CREATE_DETACHED);
    char * v2; // 0x23434
    uint32_t v3 = (int32_t)v2;
    _ZN6tvfunc15tv_cli_ipc_initEv(v3);
    if (v3 % 256 != 1) {
        // 0xc1b4
        return 0;
    }
    int32_t v4 = _ZN6tvfunc14tv_open_key_fdEv((int32_t)v2); // 0x2343c
    // branch -> 0xc1da
    while (true) {
        // 0xc1da
        accept(sock, NULL, NULL);
        int32_t err_num = *__errno_location(); // 0xc20a
        char * err_str = strerror(err_num); // 0xc20e
        int32_t v5 = *__errno_location(); // 0xc21a
        fprintf(stream, "--->ren<---accept socket error: %s(errno: %d)", err_str, v5);
        // branch -> 0xc1da
    }
}

// Address range: 0xeb04 - 0xeb1b
// Demangled:     tvfunc::tvfunc()
int32_t _ZN6tvfuncC1Ev(int32_t result) {
    struct _IO_FILE * v1; // 0x233e8
    char * v2; // 0x23434
    char * v3; // 0x23438
    int32_t v4; // 0x2343c
    // 0xeb04
    return result;
}

// Address range: 0xeb1c - 0xeb6b
// Demangled:     tvfunc::tv_cli_ipc_init()
int32_t _ZN6tvfunc15tv_cli_ipc_initEv(int32_t a1) {
    char * v1; // 0x23434
    char * v2; // 0x23438
    int32_t v3; // 0x2343c
    // 0xeb1c
    api_cli_ipc_init();
    struct _IO_FILE * stream; // 0x233e8
    fprintf(stream, "--->ren<---tv_cli_ipc_init error, exit, in the function [%s] at linenumber [%d]\n", "tv_cli_ipc_init", 9);
    return (int32_t)"--->ren<---tv_cli_ipc_init error, exit, in the function [%s] at linenumber [%d]\n";
}

// Address range: 0xf6c0 - 0xf717
// Demangled:     tvfunc::tv_open_key_fd()
int32_t _ZN6tvfunc14tv_open_key_fdEv(int32_t a1) {
    char * v1; // 0x23434
    char * v2; // 0x23438
    int32_t v3; // 0x2343c
    int32_t fd = open("/dev/input/event2", O_RDWR);
    int32_t result;
    if (fd <= 0xffffffff) {
        // 0xf6e0
        struct _IO_FILE * stream; // 0x233e8
        fprintf(stream, "--->ren<---tv_open_key_fd error, in the function [%s] at linenumber [%d]\n", "tv_open_key_fd", 418);
        result = -1;
        // branch -> 0xf70c
    } else {
        result = fd;
    }
    // 0xf70c
    return result;
}

// --------------- Dynamically Linked Functions ---------------

// int * __errno_location(void);
// void _ZdlPv(void * ptr);
// void * _Znwj(unsigned int size);
// int accept(int fd, __SOCKADDR_ARG addr, socklen_t * restrict addr_len);
// void api_cli_ipc_init(void);
// void exit(int status);
// int fprintf(FILE * restrict stream, const char * restrict format, ...);
// int open(const char * file, int oflag, ...);
// int pthread_attr_init(pthread_attr_t * attr);
// int pthread_attr_setdetachstate(pthread_attr_t * attr, int detachstate);
// int socket(int domain, int type, int protocol);
// char * strerror(int errnum);

// --------------------- Meta-Information ---------------------

// Detected compiler/packer: gcc (4.7.3)
// Detected language: C++
// Detected functions: 11
// Decompiler release: v2.2.1 (2016-09-07)
// Decompilation date: 2018-02-15 16:17:26
